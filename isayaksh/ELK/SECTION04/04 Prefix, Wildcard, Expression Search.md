# Prefix Serach
- Elasticsearch의 Prefix 검색은 Term-level 쿼리의 일종으로, 필드 값이 지정된 접두어로 시작하는 문서를 검색하는 데 사용됩니다.
- 이는 특히 특정 문자로 시작하는 용어를 일치시키고자 하지만 전체 값을 모를 때 유용합니다.

- 사용 사례
  - 자동완성 기능: 접두어 "iph" → 이 쿼리는 "iPhone", "iPhone 12", "iPhone Charger" 등과 일치하는 제품을 검색합니다.

- 고려 사항
  - 대소문자 구분 (Case-Sensitive): keyword 필드에서 사용할 경우, 접두어 검색은 대소문자를 구분합니다.
  - 성능 (Efficiency): 너무 짧은 접두어나 큰 데이터셋에서는 성능 이슈가 발생할 수 있으므로 주의해야 합니다.

# Wildcard Search
- Elasticsearch의 와일드카드 검색은 Term-level 쿼리의 일종으로,
필드 값이 와일드카드 문자와 일치하는 패턴을 따를 경우 문서를 검색할 수 있게 해줍니다.

- 와일드카드 문자
  - `*` : 빈 문자열을 포함하여 임의의 문자 시퀀스와 일치합니다.
  - `?` : 임의의 한 문자와 일치합니다.

- 고려 사항
  - 성능 (Performance) : 와일드카드 쿼리는 리소스를 많이 사용할 수 있으며, 특히 **패턴의 시작 부분에 와일드카드가 있을 경우(*phone 등), 성능 저하가 발생**할 수 있습니다.

# Regular Expression Search
- Elasticsearch의 정규 표현식 검색은 강력한 term-level 쿼리로, 필드 값이 지정된 정규 표현식(Regex)과 일치하는 문서를 검색할 수 있습니다.

- 일반적인 정규식 패턴
  - `.` : 임의의 단일 문자와 일치
  - `.*` : 임의의 문자 시퀀스(없을 수도 있음) 와 일치
  - `[abc]` : a, b, c 중 하나와 일치
  - `[a-z]` : 소문자 a부터 z 중 하나와 일치
  - `[0-9]` : 숫자 0부터 9 중 하나와 일치

- 고려 사항
  - 성능 (Performance) : 정규 표현식 쿼리는 계산 비용이 많이 들 수 있으므로, 대규모 데이터셋이나 복잡한 패턴을 사용할 때는 신중히 사용해야 합니다.

### 🔥 wildcard 성능 튜닝 방법 (rewrite 옵션)
- wildcard 쿼리가 느린 이유는, 쿼리 패턴(`abc*`, `*abc`, `a*b*c`)에 맞는 모든 term을 스캔해서 매칭하기 때문이다.
- rewrite 옵션은 wildcard 쿼리를 내부적으로 다른 방식으로 변환해서 실행하게 만들어서, 속도를 조정하거나 리소스를 아끼는 방법이다.

**주요 write 방식**

| rewrite 타입 | 설명 | 특징 |
|:-------------|:-----|:-----|
| `constant_score` (기본) | 매칭만 하고, 스코어 계산 안 함 | 빠름, 스코어 필요 없을 때 |
| `scoring_boolean` | 각 term 별로 매칭하고 스코어 합산 | 정확한 점수 필요할 때 |
| `constant_score_boolean` | boolean 쿼리로 묶되, 점수는 계산 안 함 | 빠른 성능 + 스코어 무시 |
| `top_terms_N` | 점수가 높은 N개 term만 선택 | 리소스 줄이고 상위 일부 결과만 원할 때 |
| `top_terms_boost_N` | top_terms와 비슷하지만 부스트 적용 | 특정 term에 가중치 주면서 제한 |

- 최적화 팁!
  - 가능하면 constant_score로 바꿔라. → 스코어 계산이 검색 시간을 엄청 잡아먹는다.
  - top_terms_N를 써서 결과 수 제한하기. → 수천 term 매칭을 피할 수 있다.