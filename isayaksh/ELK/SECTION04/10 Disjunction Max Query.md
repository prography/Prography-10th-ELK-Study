# Disjunction Max Query
- 분리해서 최대치에 해당하는 결과를 찾아내는 쿼리
- 여러 쿼리를 실행하고, 일치하는 모든 쿼리의 점수를 합치는 대신 가장 잘 일치하는 **하나의 쿼리**의 점수만 반환하는 컴파운드 쿼리이다.

- Disjunction Max Query의 동작 방식
  - 최고 점수 우선: dis_max 쿼리는 하위 쿼리 중에서 가장 높은 점수를 선택하여 문서의 관련성 점수로 사용한다. 이는 문서가 여러 필드나 조건과 일치할 때 점수가 과도하게 부풀려지는 것을 방지한다.
  - 동점 처리: 선택적인 tie_breaker 파라미터를 사용하면 최고 점수를 갖지 않은 하위 쿼리들의 점수 일부를 추가할 수 있다. 이는 여러 필드나 조건에 걸친 문서를 약간 보정하면서도 여전히 최고의 일치를 우선시하는 데 도움이 된다.

### 🔥 `tie_breaker`
```json
{
  "dis_max": {
    "queries": [
      { "match": { "title": "apple" }},
      { "match": { "description": "apple" }}
    ],
    "tie_breaker": 0.3
  }
}
```
- 위와 같이 여러개의 조건으로 dis_max로 조회할 때, tie_breaker가 없다면, title과 일치하는 결과만 점수를 할당한다.
- 반대로 tie_breaker가 존재한다면 description과 일치하는 결과도 30%에 해당하는 가점을 주어 점수에 반영한다.

## Comparison with multi_match
- `multi_match` 쿼리: 여러 필드에서 점수를 결합하며, 다양한 모드(best_fields, most_fields 등)에 기반하여 동작한다. 일반적으로 점수를 합산하거나 평균내고 싶은 다중 필드 검색에 사용되는 쿼리이다.
- `dis_max` 쿼리: 하위 쿼리 중 가장 높은 점수에 집중하며, 최상의 일치를 강조하고 싶을 때 사용되는 쿼리이다. 보조 일치를 위한 선택적인 tie_breaker도 함께 사용할 수 있다.
- 🔥 multi_match는 여러 필드를 동시에 검색하면서 다양한 스코어링 전략을 제공하고, dis_max는 여러 쿼리 중 가장 높은 점수만을 대표 점수로 사용하며 점수 중복을 방지하는 데 초점을 둔다.

