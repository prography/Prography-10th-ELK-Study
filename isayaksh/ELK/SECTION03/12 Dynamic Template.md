# Dynamic Template이란?
- Elasticsearch의 동적 템플릿은 동적으로 추가되는 필드에 대해 사용자 정의 규칙을 설정할 수 있는 기능이다.
- dynamic_templates를 사용하면 필드의 이름, 타입, 기타 속성에 따라 특정 필드에 대해 더 세분화된 규칙을 정의할 수 있다.

## Dynamic Templates를 사용하는 이유
- 유연성(Flexibility): 동적으로 추가되는 다양한 유형의 필드가 어떻게 색인되고 분석될지 사용자 정의할 수 있다.
- 제어(Control): 필드 이름이나 데이터 타입 같은 패턴이나 조건에 따라 특정 매핑을 적용할 수 있다.
- 효율성(Efficiency): 모든 필드를 사전에 정의하지 않아도, 분석기나 색인 옵션 같은 설정을 자동으로 적용할 수 있다.

### 🔥 Dynamic Template 효용성?
- Production 단계에서는 많이 사용하지 않는다.

(1) 🔎 예측 불가능한 매핑 생성

동적 템플릿은 이름이나 타입 패턴에 따라 자동으로 매핑을 생성함. 하지만, 이 패턴이 의도와 다르게 동작할 수 있음. 비슷한 필드인데 다르게 처리되면 검색·집계 시 일관성 깨짐.
예: user_name → text, username → keyword로 서로 다르게 매핑됨.

(2) ⚠️ 타입 충돌 위험

하나의 필드가 서로 다른 타입으로 들어오면 ES는 에러를 발생시킴. 운영 환경에선 데이터 일관성이 필수이므로, 이런 충돌은 치명적임.
예: 처음엔 age: "30" (문자열)로 들어오고, 다음엔 age: 30 (숫자)으로 들어오면 → 매핑 충돌

(3) 🧩 복잡한 구조일수록 관리 어려움

객체(object) 타입이나 중첩 구조에서 예상치 못한 필드까지 자동 매핑되면 매핑 문서가 불필요하게 커지고 인덱싱 성능이 저하될 수 있음

(4) 🔒 보안 및 데이터 유효성 관리 어려움
API로 외부에서 들어오는 데이터가 템플릿 조건에 맞으면 의도하지 않은 필드가 색인될 수 있음. 이건 불필요한 데이터 유입 또는 보안 취약점으로 이어질 수 있음

(5) 📉 인덱스 최적화 방해
운영 환경에서는 필드에 따라 Analysis 설정, doc_values, norms, index 여부 등을 세밀하게 조절해야 하는데 Dynamic Template은 이런 걸 자동 적용하므로 최적화가 어려움

즉, 운영 환경에서는 매핑은 명시적으로 수동 설정하거나, Dynamic은 false 또는 "strict"로 설정해서 새로운 필드는 색인되지 않거나 오류 처리할 수 있도록 한다.

정리하면, 필드 구조가 자주 바뀌지 않도록 스키마를 고정하는 전략을 사용하는 것이 좋다.